RewriteEngine On

# Permitir CORS para todos los orígenes
Header always set Access-Control-Allow-Origin "*"
Header always set Access-Control-Allow-Methods "GET, POST, OPTIONS, DELETE, PATCH"
Header always set Access-Control-Allow-Headers "Content-Type, Authorization, X-Requested-With"

# Manejar preflight requests
RewriteCond %{REQUEST_METHOD} OPTIONS
RewriteRule ^(.*)$ $1 [R=200,L]

# Reescribir rutas de API
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d

# Rutas de autenticación
RewriteRule ^api/auth/(.*)$ /api/auth.php [L,QSA]

# Rutas de WhatsApp
RewriteRule ^api/whatsapp/(.*)$ /api/whatsapp.php [L,QSA]

# Fallback para otras rutas de API
RewriteRule ^api/(.*)$ /api/$1.php [L,QSA]

# Configuración de seguridad
<Files "*.php">
    Order Allow,Deny
    Allow from all
</Files>

# Evitar acceso directo a archivos de configuración
<Files "config.php">
    Order Deny,Allow
    Deny from all
</Files>

# Configuración de errores
ErrorDocument 404 /404.html
ErrorDocument 500 /500.html

# Configuración de PHP (si está permitido)
<IfModule mod_php.c>
    php_value display_errors Off
    php_value log_errors On
    php_value error_log /tmp/php_errors.log
</IfModule>
